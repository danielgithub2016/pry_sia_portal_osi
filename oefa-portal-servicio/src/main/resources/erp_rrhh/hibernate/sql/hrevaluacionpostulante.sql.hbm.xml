<?xml version="1.0" encoding="UTF-8"?>
<!--
 *
 * @author : desarrollo
 * @powerbuilder : rrhh.HrEvaluacionpostulante
-->
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <sql-query name="hrevaluacionpostulante.dwhrrequerimientoevalentrevistaeditb">
	  <![CDATA[
	 	SELECT  
				HR_EVALUACIONPOSTULANTE.REQUERIMIENTO as "requerimiento",
				HR_EVALUACIONPOSTULANTE.SECUENCIA as "secuencia",
				HR_EVALUACIONPOSTULANTE.SECUENCIA_2  as "secuencia2",
				HR_EVALUACIONPOSTULANTE.COMPANYOWNER  as "companyowner",
				HR_EVALUACIONPOSTULANTE.POSTULANTE as "postulante",
				HR_EVALUACIONPOSTULANTE.FACTOR as "factor", 
				HR_EVALUACIONPOSTULANTE.FLAGAPROBACION as "flagaprobacion",
				HR_EVALUACIONPOSTULANTE.ULTIMOUSUARIO as "ultimousuario", 
				HR_EVALUACIONPOSTULANTE.ULTIMAFECHAMODIF as "ultimafechamodif",
				HR_EVALUACIONPOSTULANTE.CALIFICATIVO as "calificativo",
				HR_EVALUACIONPOSTULANTE.UNIDADNEGOCIO as "unidadnegocio",
				HR_EVALREQUERIMIENTO.ETAPA as "etapa",
				'' AS "descevaluacion",				
				(SELECT HR_EVALUACION.DESCRIPCION
				FROM SGCORESYS.HR_EVALUACION
				WHERE HR_EVALUACION.EVALUACION = HR_EVALREQUERIMIENTO.EVALUACION) AS "descripcioneval",
				(SELECT HR_EVALUACION.PUNTAJEMINIMO
				FROM SGCORESYS.HR_EVALUACION
				WHERE HR_EVALUACION.EVALUACION = HR_EVALREQUERIMIENTO.EVALUACION) AS "ponderacion",
				FE.DESCRIPCION AS "descripcion",
				FE.EXPLICACION AS "explicacion",
				FE.DESCRIPCION AS "descripcionfactor2",
				FE.ORDENPLANTILLA AS "ordenplantilla",
				FE.VALORREQUERIDO AS "valorrequerido",
				FE.FLAGCALIFICACION AS "flagcalificacion",
				HR_EVALUACIONPOSTULANTE.FACTORCOMPETENCIA AS "factorcompetencia",
				HR_EVALUACIONPOSTULANTE.SECUENCIACOMPETENCIA AS "secuenciacompetencia",
				HR_EVALUACIONPOSTULANTE.PUNTAJE AS "puntaje",
				HR_EVALUACIONPOSTULANTE.COMENTARIO AS "comentario",
				HR_EVALUACIONPOSTULANTE.RUTADOCUMENTO AS "rutadocumento",
				HR_EVALUACIONPOSTULANTE.VALORHASTACOMPETENCIA AS "valorhastacompetencia",
				HR_EVALUACIONPOSTULANTE.VALORCOMPETENCIA AS "valorcompetencia",
				ROUND((HR_EVALUACIONPOSTULANTE.VALORHASTACOMPETENCIA + HR_EVALUACIONPOSTULANTE.VALORCOMPETENCIA) / 2, 2) AS "cfmedio",
				(SELECT A.DESCRIPCION FROM SGCORESYS.HR_FACTORVALOR A WHERE A.FACTOR = HR_EVALUACIONPOSTULANTE.FACTOR AND A.SECUENCIA = HR_EVALUACIONPOSTULANTE.PUNTAJE)	AS "cfvalortextofactor",
				CAST(( SELECT TIPOEVAL FROM  SGCORESYS.HR_EVALUACION WHERE EVALUACION = HR_EVALREQUERIMIENTO.EVALUACION) AS VARCHAR2(1)) AS "tipoeval",
				HR_EVALUACIONPOSTULANTE.FLAGCALIFICADO AS "flagcalificado", 
				HR_EVALUACIONPOSTULANTE.ENTREVISTADOR AS "entrevistador"
				
				FROM 
				        SGCORESYS.HR_EVALUACIONPOSTULANTE
				LEFT JOIN SGCORESYS.HR_FACTORESEVALUACION FE ON
				    HR_EVALUACIONPOSTULANTE.FACTOR =FE.FACTOR
				LEFT JOIN SGCORESYS.HR_EVALREQUERIMIENTO ON
				  ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO    = HR_EVALREQUERIMIENTO.REQUERIMIENTO ) AND
				  ( HR_EVALUACIONPOSTULANTE.SECUENCIA         = HR_EVALREQUERIMIENTO.SECUENCIA ) AND 
				  ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER    = HR_EVALREQUERIMIENTO.COMPANYOWNER )
				WHERE 
				  ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER = :par_companyowner ) AND
				  ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO = :par_requerimiento )
	  ]]>
    </sql-query>
    
    <sql-query name="hrevaluacionpostulante.dwhrrequerimientoevalpostedit2">
	  <![CDATA[
	  SELECT  
		    HR_EVALUACIONPOSTULANTE.SECUENCIA AS "secuencia" ,
		    HR_EVALUACIONPOSTULANTE.POSTULANTE AS "postulante",
		    HR_EVALUACIONPOSTULANTE.SECUENCIA_2 AS "secuencia2",
		    SUM((CASE WHEN HR_EVALUACIONPOSTULANTE.FLAGCALIFICADO = 'S' AND (FE.FLAGCALIFICACION = '1' OR FE.FLAGCALIFICACION = '2') THEN (CASE WHEN HR_EVALUACIONPOSTULANTE.PUNTAJE IS NULL THEN 0 ELSE HR_EVALUACIONPOSTULANTE.PUNTAJE END) ELSE 0 END)) AS "calificacionsum",
		    SUM((CASE WHEN HR_EVALUACIONPOSTULANTE.FLAGCALIFICADO = 'S'  AND (FE.FLAGCALIFICACION = '1' OR FE.FLAGCALIFICACION = '2') THEN 1 ELSE 0 END)) AS "calificacioncount",
		    HR_EVALUACION.DESCRIPCION AS "descripcioneval",
		    (SELECT HR_PUESTOEMPRESA.DESCRIPCION FROM SGCORESYS.HR_PUESTOEMPRESA WHERE HR_PUESTOEMPRESA.CODIGOPUESTO = HR_EVALREQUERIMIENTO_2.CODIGOPUESTO) AS "descripcioncargo",
		    CASE WHEN FE.FLAGCALIFICACION = '3' THEN MAX(HR_FACTORVALOR.DESCRIPCION) ELSE '' END AS "descripcionvalor",
		    FE.FLAGCALIFICACION AS "flagcalificacion", 
		    HR_EVALUACIONETAPA.ESTADO AS "estado",
		    0 AS "cfrow1",
		    0 AS "cfrow2"
		FROM 
		    SGCORESYS.HR_EVALUACIONPOSTULANTE
		    LEFT JOIN SGCORESYS.HR_FACTORESEVALUACION FE ON HR_EVALUACIONPOSTULANTE.FACTOR =FE.FACTOR
		    LEFT JOIN SGCORESYS.HR_EVALUACIONETAPA ON ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO        = HR_EVALUACIONETAPA.REQUERIMIENTO ) AND ( HR_EVALUACIONPOSTULANTE.SECUENCIA             = HR_EVALUACIONETAPA.SECUENCIA ) AND 
		        ( HR_EVALUACIONPOSTULANTE.SECUENCIA_2         = HR_EVALUACIONETAPA.SECUENCIA_2 ) AND ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER    = HR_EVALUACIONETAPA.COMPANYOWNER ) AND
		        ( HR_EVALUACIONPOSTULANTE.POSTULANTE            = HR_EVALUACIONETAPA.POSTULANTE )
		    LEFT JOIN SGCORESYS.HR_EVALREQUERIMIENTO ON ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO    = HR_EVALREQUERIMIENTO.REQUERIMIENTO ) AND ( HR_EVALUACIONPOSTULANTE.SECUENCIA         = HR_EVALREQUERIMIENTO.SECUENCIA ) AND 
		        ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER    = HR_EVALREQUERIMIENTO.COMPANYOWNER )
		    LEFT JOIN SGCORESYS.HR_EVALREQUERIMIENTO_2 ON ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO    = HR_EVALREQUERIMIENTO_2.REQUERIMIENTO ) AND ( HR_EVALUACIONPOSTULANTE.SECUENCIA         = HR_EVALREQUERIMIENTO_2.SECUENCIA ) AND 
		        ( HR_EVALUACIONPOSTULANTE.SECUENCIA_2    = HR_EVALREQUERIMIENTO_2.SECUENCIA_2 ) AND ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER    = HR_EVALREQUERIMIENTO_2.COMPANYOWNER )
		     LEFT JOIN SGCORESYS.HR_FACTORVALOR ON (FE.FACTOR = HR_FACTORVALOR.FACTOR AND HR_EVALUACIONPOSTULANTE.PUNTAJE = HR_FACTORVALOR.VALOR AND HR_FACTORVALOR.SECUENCIA = HR_EVALUACIONPOSTULANTE.PUNTAJE)
		    LEFT JOIN SGCORESYS.HR_EVALUACION ON (HR_EVALUACION.EVALUACION = HR_EVALREQUERIMIENTO.EVALUACION)
		WHERE 
		  ( HR_EVALUACIONPOSTULANTE.COMPANYOWNER = :par_companyowner ) AND       
		  ( HR_EVALUACIONPOSTULANTE.REQUERIMIENTO = :par_requerimiento )
		GROUP BY
		HR_EVALUACIONPOSTULANTE.REQUERIMIENTO ,
		HR_EVALUACIONPOSTULANTE.SECUENCIA,
		HR_EVALREQUERIMIENTO.EVALUACION,
		HR_EVALUACIONPOSTULANTE.SECUENCIA_2,
		HR_EVALUACIONPOSTULANTE.COMPANYOWNER,
		HR_EVALREQUERIMIENTO_2.CODIGOPUESTO,
		HR_EVALUACIONPOSTULANTE.POSTULANTE,
		HR_EVALUACIONETAPA.ESTADO,FE.FLAGCALIFICACION,HR_EVALUACIONPOSTULANTE.SECUENCIA,
		HR_EVALUACION.DESCRIPCION		
		ORDER BY 2,3
	  ]]>
    </sql-query>
</hibernate-mapping>
